
@{
    Layout = "~/Views/Shared/_Layout.Mobile.cshtml";
}

<div class="main_container">

    <div style="width: 100% !important; text-align: center; padding: 10px 0px 10px 0px; background-color: #333333; margin-bottom: 5px;">

        <img src="~/Content/Images/logo-maxi.png" style="max-width: 100% !important;" />
        
    </div>

    <!-- page content -->
    <div role="main">
        @{
            if (Sessao.Usuario.Nivel > 1)
            {
                <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>Filtrar Agenda</h2>
                                <ul class="right panel_toolbox" style="list-style: none;">
                                    <li>
                                        <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                    </li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <form id="agenda-filtrar-form" data-parsley-validate class="form-horizontal form-label-left">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label class="titlefield">Sede <span class="required">*</span></label>
                                                <select id="FiltrarSede" name="FiltrarSede" class="form-control placeholder" data-msg-required="Por favor, selecione uma Sede." data-rule-required="true">
                                                    <option value="">Selecione a Sede</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="titlefield">Profissional <span class="required">*</span></label>
                                                <select id="FiltrarProfissional" name="FitrarProfissional" class="form-control placeholder" data-msg-required="Por favor, selecione o Profissional." data-rule-required="true">
                                                    <option value="">Selecione o Profissional</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-2" style="padding-bottom: 0px !important;">
                                            <div class="form-group" style="margin-bottom: 0px !important; padding-top: 23px !important;">
                                                <button type="button" class="btn btn-primary" style="margin-bottom: 0px !important;" onclick="FiltrarAgenda();">Filtrar</button>
                                                &nbsp;
                                                <button type="button" class="btn btn-default" style="margin-bottom: 0px !important;" onclick="LimparAgenda();">Limpar</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            }
        }

        <div class="row">
            <div class="col-md-12">
                <div id='calendar'></div>
            </div>
        </div>
    </div>

    <!-- Start Calender modal -->
    <div id="CalenderModal" class="modal fade" role="dialog">
        <div class="modal-dialog modal-lg">

            <!-- Modal content-->
            <form id="antoform" class="form-horizontal calender" role="form">
                <input type="hidden" id="id" name="id" value="">
                <input type="hidden" id="idEvent" name="idEvent" value="">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" style="font-size: 24pt;">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabelTitle">Novo Agendamento</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="titlefield">Data</label>
                                    <input type="text" class="form-control" id="Data" name="Data" disabled="disabled">
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="form-group">
                                    <label class="titlefield">Assunto <span class="required">*</span></label>
                                    <select id="Assunto" name="Assunto" class="form-control placeholder" data-msg-required="Por favor, selecione um Assunto." data-rule-required="true">
                                        <option value="">Selecione o Assunto</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="titlefield">Sede <span class="required">*</span></label>
                                    <select id="Sede" name="Sede" class="form-control placeholder" data-msg-required="Por favor, selecione uma Sede." data-rule-required="true">
                                        <option value="">Selecione a Sede</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="titlefield">Sala</label>
                                    <select id="Sala" name="Sala" class="form-control placeholder">
                                        <option value="">Selecione a Sala</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label class="titlefield">Valor R$</label>
                                    <input type="text" class="form-control right" placeholder="Informe o Valor" id="Valor" name="Valor" maxlength="14" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="titlefield">Profissional <span class="required">*</span></label>
                                    <select id="Profissional" name="Profissional" class="form-control placeholder" data-msg-required="Por favor, selecione o Profissional." data-rule-required="true">
                                        <option value="">Selecione o Profissional</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-5">
                                <div class="form-group">
                                    <label class="titlefield">Cliente</label>
                                    <br />
                                    <select id="Cliente" name="Cliente" class="select2_single form-control" style="width: 100% !important;"></select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="titlefield">Indicação</label>
                                    <input type="text" class="form-control" placeholder="Informe o Nome de quem Indicou" id="Indicacao" name="Indicacao" />
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="titlefield">Telefone</label>
                                    <input type="text" class="form-control" placeholder="Informe o Telefone" id="Telefone" name="Telefone" />
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="titlefield">Descrição</label>
                                    <textarea class="form-control" style="height:55px;" id="Descricao" name="Descricao"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-warning" id="agenda-profissional-alert-error" hidden="hidden">
                        <strong>Aviso:</strong> O Profissional seleciondo já tem agenda nesta data e hora.
                    </div>
                    <div class="alert alert-warning" id="agenda-sede-alert-error" hidden="hidden">
                        <strong>Aviso:</strong> A Sala selecionada nesta Sede já esta agendada nesta data e hora.
                    </div>
                    <div class="modal-footer">
                        <div class="wrapper">
                            <div class="left">
                                <button id="ButtonRemoveEvent" type="button" class="btn btn-danger mb-2" style="margin: 0;" data-dismiss="modal" data-toggle="modal" data-target="#modalExcluir" onclick="Excluir($('#id').val(), $('#idEvent').val());">Remover</button>
                            </div>
                            <div class="right">
                                <button id="ButtonSaveEvent" type="button" class="btn btn-primary antosubmit" style="margin: 0;">Salvar</button>
                                &nbsp;
                                <button type="button" class="btn btn-default antoclose" data-dismiss="modal" onclick="$('#antoform').validate().resetForm();">Cancelar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>

        </div>
    </div>

    <div id="fc_create" data-toggle="modal" data-target="#CalenderModal"></div>
    <div id="fc_edit" data-toggle="modal" data-target="#CalenderModal"></div>
    <!-- End Calender modal -->
    <!-- /page content -->
</div>

<script type="text/javascript" src="~/Scripts/jquery.maskMoney.js"></script>
<script type="text/javascript" src="~/Scripts/jquery.mask.js"></script>

<script>

    $("#Valor").maskMoney({ prefix: 'R$ ', allowNegative: true, thousands: '.', decimal: ',', affixesStay: true });
    $("#Telefone").mask("(99) 9999-9999?9");

    CarregarTiposAgendas();
    CarregarSedes();
    CarregarProfissionais("");
    CarregarClientes();

    $('#Cliente').change(function () {

        if ($('#Cliente option:selected').val() == 0 || !$.isNumeric($('#Cliente option:selected').val())) {
            $('#Indicacao').val("");
            $('#Telefone').val("");
        }
        else {

            var dados = new window.FormData();
            dados.append("Id", $('#Cliente option:selected').val());

            var options = {};
            options.url = "/Clientes/Consultar"
            options.type = "POST";
            options.data = dados;
            options.asyn = true;
            options.contentType = false;
            options.processData = false;
            options.dataType = "application/json; charset=utf-8";
            options.complete = function (data) {

                var json = $.parseJSON(data.responseText);

                if (json.codigo == '00') {

                    $('#Indicacao').val(json.cliente[0].Indicacao);

                    if (json.cliente[0].Telefone != null) {
                        $('#Telefone').val(FormatNumber(json.cliente[0].Telefone, '(##) ####-####'));
                    }
                    else {
                        $('#Telefone').val("");
                    }

                }

            };
            $.ajax(options);

        }

    });

    $(window).load(function () {

        $("#Cliente").select2({
            placeholder: "Selecione o Cliente",
            allowClear: true,
            tags: true
        });

        var events = [];

        CarregarEventos();

        function CarregarEventos() {

            var options = {};
            options.url = "/Agendas/Eventos"
            options.type = "POST";
            options.asyn = true;
            options.contentType = false;
            options.processData = false;
            options.dataType = "application/json; charset=utf-8";
            options.complete = function (data) {

                events = $.parseJSON(data.responseText);
                $('#calendar').fullCalendar('refetchEvents');

            };
            $.ajax(options);

        }

        var started;

        var calendar = $('#calendar').fullCalendar({
            defaultView: 'agendaDay',
            ignoreTimezone: false,
            monthNames: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],
            monthNamesShort: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
            dayNames: ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sabado'],
            dayNamesShort: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sab'],
            columnFormat: {
                month: 'ddd',
                week: 'ddd DD',
                day: ''
            },
            axisFormat: 'H:mm',
            timeFormat: {
                '': 'H:mm',
                agenda: 'H:mm'
            },
            buttonText: {
                today: "Hoje",
                month: "Mês",
                week: "Semana",
                day: "Dia"
            },
            timeFormat: "HH:mm",
            minTime: "06:00:00",
            maxTime: "24:00:00",
            lotDuration: '00:00:00',
            snapDuration: '00:60:00',
            allDayText: 'Dia todo',
            allDaySlot: false,
            editable: false,
            selectable: true,
            selectHelper: true,
            header: {
                left: 'prev,next today',
                center: '',
                right: 'title'
            },
            weekends: false,
            select: function (start, end, allDay) {

                var view = $('#calendar').fullCalendar('getView');

                if (start.isBefore(moment()) || view.name == "month" || start.isoWeekday() == 6 || start.isoWeekday() == 7) {
                    $('#calendar').fullCalendar('unselect');
                    return false;
                }
                else {

                    $('#agenda-profissional-alert-error').hide();
                    $('#agenda-sede-alert-error').hide();

                    $("#myModalLabelTitle").text("Novo Agendamento");
                    $("#Data").val(start.toISOString().match(/^[0-9]{4}\-[0-9]{2}\-[0-9]{2}/)[0].split('-').reverse().join('/'));
                    CarregarProfissionais($("#Data").val());

                    $('#Assunto').val('');
                    $('#Sede').val('');
                    $('#Sala').val('');
                    $('#Valor').val('');
                    $('#Profissional').val('');
                    $('#Cliente').val('');
                    $('#Cliente').trigger('change');
                    $('#Indicacao').val('');
                    $('#Telefone').val('');
                    $('#Descricao').val('');

                    $('#id').val("");
                    $('#idEvent').val("");
                    $('#ButtonRemoveEvent').hide();
                    $('#ButtonSaveEvent').show();

                    $('#fc_create').click();

                    started = start;
                    ended = end;

                    var futureDate = new Date(end);
                    var todayDate = new Date(start);
                    var milliseconds = futureDate.getTime() - todayDate.getTime();
                    var hours = Math.floor(milliseconds / (60 * 60 * 1000));

                    if (hours == 24) {
                        allDay = true;
                    }
                    else {
                        allDay = false;
                    }

                    $(".antosubmit").on("click", function () {

                        $("#antoform").validate();

                        if ($('#antoform').valid()) {

                            if (end) {
                                ended = end;
                            }

                            if ($('#id').val() == "") {

                                var eventDate = new Date(started);
                                var dados = new window.FormData();
                                dados.append("Id", 0);
                                dados.append("Data", $("#Data").val());
                                dados.append("Hora", eventDate.getHours());
                                dados.append("IdTipo", $("#Assunto").val());
                                dados.append("IdSede", $("#Sede").val());
                                dados.append("IdSala", $("#Sala").val());
                                dados.append("IdProfissional", $("#Profissional").val());
                                dados.append("Valor", $("#Valor").val());

                                if ($.isNumeric($('#Cliente option:selected').val())) {
                                    dados.append("IdCliente", $('#Cliente option:selected').val());
                                } else if ($('#Cliente option:selected').val() != null) {
                                    dados.append("Cliente", $('#Cliente option:selected').val());
                                }

                                dados.append("Indicacao", $("#Indicacao").val());
                                dados.append("Telefone", $("#Telefone").val());
                                dados.append("Descricao", $("#Descricao").val());

                                var title = $("#Sede option:selected").html() + " - " + $("#Profissional option:selected").html();

                                var options = {};
                                options.url = "/Agendas/Salvar"
                                options.type = "POST";
                                options.data = dados;
                                options.asyn = true;
                                options.contentType = false;
                                options.processData = false;
                                options.dataType = "application/json; charset=utf-8";
                                options.complete = function (data) {

                                    var json = $.parseJSON(data.responseText);

                                    if (json.codigo == '00') {

                                        calendar.fullCalendar('renderEvent', {
                                            id: json.id,
                                            title: json.title,
                                            start: started,
                                            end: started + 3600000,
                                            allDay: allDay
                                        },
                                            true // make the event "stick"
                                        );

                                        CarregarClientes();

                            calendar.fullCalendar('unselect');

                                        $('.antoclose').click();

                                    }
                                    else if (json.codigo == '-90') {

                                        $('#agenda-profissional-alert-error').show();

                                    }
                                    else if (json.codigo == '-80') {

                                        $('#agenda-sede-alert-error').show();

                                    }

                                };
                                $.ajax(options);

                            }

                            //return false;

                        }
                        else {

                            return false;

                        }

                    });

                }
            },
            eventClick: function (calEvent, jsEvent, view) {

                $('#agenda-profissional-alert-error').hide();
                $('#agenda-sede-alert-error').hide();

                var dt = new Date(calEvent.start);
                CarregarProfissionais(dt.getFullYear() + "/" + (dt.getMonth() + 1) + "/" + dt.getDate());

                $("#myModalLabelTitle").text("Alterar Agendamento");

                $('#id').val(calEvent.id);
                $('#idEvent').val(calEvent._id);
                $('#ButtonRemoveEvent').show();

                if (calEvent.start.isBefore(moment())) {
                    $('#ButtonSaveEvent').hide();
                }
                else {
                    $('#ButtonSaveEvent').show();
                }

                var dados = new window.FormData();
                dados.append("Id", calEvent.id);

                var options = {};
                options.url = "/Agendas/Consultar"
                options.type = "POST";
                options.data = dados;
                options.asyn = true;
                options.contentType = false;
                options.processData = false;
                options.dataType = "application/json; charset=utf-8";
                options.complete = function (data) {

                    var json = $.parseJSON(data.responseText);

                    if (json.codigo == '00') {

                        $('#Data').val(json.agenda[0].Data);
                        $('#Assunto').val(json.agenda[0].IdTipo);
                        $('#Sede').val(json.agenda[0].IdSede);

                        if (json.agenda[0].Valor != null) {
                            $('#Valor').val(('R$ ' + mascaraValor(json.agenda[0].Valor.toFixed(2))));
                        }

                        $('#Profissional').val(json.agenda[0].IdProfissional);
                        $('#Cliente').val(json.agenda[0].IdCliente); // Select the option with a value of '1'
                        $('#Cliente').trigger('change'); // Notify any JS components that the value changed
                        $('#Indicacao').val(json.agenda[0].Indicacao);

                        if (json.agenda[0].Telefone != null) {
                            $('#Telefone').val(FormatNumber(json.agenda[0].Telefone, '(##) ####-####'));
                        }
                        else {
                            $('#Telefone').val("");
                        }

                        $('#Descricao').val(json.agenda[0].Descricao);

                        CarregarSalas(json.agenda[0].IdSede, json.agenda[0].IdSala);

                    }
                };
                $.ajax(options);

                $('#fc_edit').click();

                $(".antosubmit").on("click", function () {

                    $("#antoform").validate();

                    if ($('#antoform').valid()) {

                        if ($('#id').val() == calEvent.id) {
                            var eventDate = new Date(started);
                            var dados = new window.FormData();
                            dados.append("Id", calEvent.id);
                            dados.append("Data", $("#Data").val());
                            dados.append("Hora", eventDate.getHours());
                            dados.append("IdTipo", $("#Assunto").val());
                            dados.append("IdSede", $("#Sede").val());
                            dados.append("IdSala", $("#Sala").val());
                            dados.append("IdProfissional", $("#Profissional").val());
                            dados.append("Valor", $("#Valor").val());

                            if ($.isNumeric($('#Cliente option:selected').val())) {
                                dados.append("IdCliente", $('#Cliente option:selected').val());
                            } else if ($('#Cliente option:selected').val() != null) {
                                dados.append("Cliente", $('#Cliente option:selected').val());
                            }

                            dados.append("Indicacao", $("#Indicacao").val());
                            dados.append("Telefone", $("#Telefone").val());
                            dados.append("Descricao", $("#Descricao").val());

                            var options = {};
                            options.url = "/Agendas/Salvar"
                            options.type = "POST";
                            options.data = dados;
                            options.asyn = true;
                            options.contentType = false;
                            options.processData = false;
                            options.dataType = "application/json; charset=utf-8";
                            options.complete = function (data) {

                                var json = $.parseJSON(data.responseText);

                                if (json.codigo == '00') {

                                    calEvent.title = json.title;
                                    calendar.fullCalendar('updateEvent', calEvent);

                                    CarregarClientes();
                                    $('.antoclose').click();

                                    return true;

                                }
                                else if (json.codigo == '-90') {

                                    $('#agenda-profissional-alert-error').show();

                                }
                                else if (json.codigo == '-80') {

                                    $('#agenda-sede-alert-error').show();

                                }
                            };

                            $.ajax(options);

                        }

                    }
                    else {

                        return false;

                    }

                });
                calendar.fullCalendar('unselect');
            },
            eventTimeFormat: { // like '14:30:00'
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                meridiem: false
            },
            events: function (start, end, tz, callback) {
                callback(events);
            }
        });

    });

    function Excluir(Id, IdEvento) {

        $('#id').val('');
        $('#idEvent').val('');

        var dados = new window.FormData();
        dados.append("Id", Id);

        var options = {};
        options.url = "/Agendas/Excluir"
        options.type = "POST";
        options.data = dados;
        options.asyn = true;
        options.contentType = false;
        options.processData = false;
        options.dataType = "application/json; charset=utf-8";
        options.complete = function (data) {

            var json = $.parseJSON(data.responseText);

            if (json.codigo == '00') {

                $('#calendar').fullCalendar('removeEvents', IdEvento);

            }

        };
        $.ajax(options);
    }

    function CarregarTiposAgendas() {
        var options = {};
        options.url = "/TiposAgendas/Listar"
        options.type = "POST";
        options.asyn = true;
        options.contentType = false;
        options.processData = false;
        options.dataType = "application/json; charset=utf-8";
        options.complete = function (data) {

            var json = $.parseJSON(data.responseText);

            if (json.codigo == '00') {

                var rows = json.tipos;
                $('#Assunto').html("");
                var select = $('#Assunto');
                select.append(
                    $('<option selected disabled></option>').val("").html("Selecione um Assunto")
                );

                for (index = 0; index < rows.length; index++) {
                    select.append(
                        $('<option></option>').val(rows[index].Id).html(rows[index].Nome)
                    );
                }

            }
        };
        $.ajax(options);
    }

    function CarregarSedes() {
        var options = {};
        options.url = "/Sedes/Listar"
        options.type = "POST";
        options.asyn = true;
        options.contentType = false;
        options.processData = false;
        options.dataType = "application/json; charset=utf-8";
        options.complete = function (data) {

            var json = $.parseJSON(data.responseText);

            if (json.codigo == '00') {

                var rows = json.sedes;
                $('#Sede').html("");
                var select = $('#Sede');
                select.append(
                    $('<option selected disabled></option>').val("").html("Selecione a Sede")
                );

                for (index = 0; index < rows.length; index++) {
                    select.append(
                        $('<option></option>').val(rows[index].Id).html(rows[index].Nome)
                    );
                }

                $('#FiltrarSede').html("");
                var select = $('#FiltrarSede');
                select.append(
                    $('<option selected disabled></option>').val("").html("Selecione a Sede")
                );

                for (index = 0; index < rows.length; index++) {
                    select.append(
                        $('<option></option>').val(rows[index].Id).html(rows[index].Nome)
                    );
                }

            }
        };
        $.ajax(options);
    }

    $('#Sede').change(function (evt) {

        CarregarSalas($("#Sede").val(), "");

    });

    function CarregarSalas(IdSede, IdSala) {

        var dados = new window.FormData();
        dados.append("IdSede", IdSede);

        var options = {};
        options.url = "/Salas/Listar"
        options.type = "POST";
        options.data = dados;
        options.asyn = true;
        options.contentType = false;
        options.processData = false;
        options.dataType = "application/json; charset=utf-8";
        options.complete = function (data) {

            var json = $.parseJSON(data.responseText);

            if (json.codigo == '00') {

                var rows = json.salas;
                $('#Sala').html("");
                var select = $('#Sala');
                select.append(
                    $('<option selected disabled></option>').val("").html("Selecione a Sala")
                );

                for (index = 0; index < rows.length; index++) {

                    if (IdSala == rows[index].Id) {

                        select.append(
                            $('<option selected></option>').val(rows[index].Id).html(rows[index].Nome)
                        );

                    } else {

                        select.append(
                            $('<option></option>').val(rows[index].Id).html(rows[index].Nome)
                        );

                    }
                }

            }
        };
        $.ajax(options);
    }

    function CarregarProfissionais(Data) {

        var dados = new window.FormData();
        dados.append("Data", Data);

        var options = {};
        options.url = "/Profissionais/Listar"
        options.type = "POST";
        options.data = dados;
        options.asyn = true;
        options.contentType = false;
        options.processData = false;
        options.dataType = "application/json; charset=utf-8";
        options.complete = function (data) {

            var json = $.parseJSON(data.responseText);

            if (json.codigo == '00') {

                var rows = json.profissionais;
                $('#Profissional').html("");
                var select = $('#Profissional');
                select.append(
                    $('<option selected disabled></option>').val("").html("Selecione um Profissional")
                );

                for (index = 0; index < rows.length; index++) {
                    select.append(
                        $('<option></option>').val(rows[index].Id).html(rows[index].Nome + (rows[index].Total > 0 ? " (" + rows[index].Total + ")" : ""))
                    );
                }

                $('#FiltrarProfissional').html("");
                var select = $('#FiltrarProfissional');
                select.append(
                    $('<option selected disabled></option>').val("").html("Selecione um Profissional")
                );

                for (index = 0; index < rows.length; index++) {
                    select.append(
                        $('<option></option>').val(rows[index].Id).html(rows[index].Nome)
                    );
                }

            }
        };
        $.ajax(options);
    }

    function CarregarClientes() {
        var options = {};
        options.url = "/Clientes/Listar"
        options.type = "POST";
        options.asyn = true;
        options.contentType = false;
        options.processData = false;
        options.dataType = "application/json; charset=utf-8";
        options.complete = function (data) {

            var json = $.parseJSON(data.responseText);

            if (json.codigo == '00') {

                var rows = json.clientes;
                $('#Cliente').html("");
                var select = $('#Cliente');
                select.append(
                    $('<option selected disabled></option>').val("").html("Selecione um Cliente")
                );

                for (index = 0; index < rows.length; index++) {
                    select.append(
                        $('<option></option>').val(rows[index].Id).html(rows[index].Nome)
                    );
                }
            }
        };
        $.ajax(options);
    }

    function FiltrarAgenda() {

        var dados = new window.FormData();
        dados.append("IdSede", $('#FiltrarSede').val());
        dados.append("IdProfissional", $('#FiltrarProfissional').val());

        var options = {};
        options.url = "/Agendas/Eventos"
        options.type = "POST";
        options.data = dados;
        options.asyn = true;
        options.contentType = false;
        options.processData = false;
        options.dataType = "application/json; charset=utf-8";
        options.complete = function (data) {

            events = $.parseJSON(data.responseText);
            $('#calendar').fullCalendar('removeEvents');
            $('#calendar').fullCalendar('addEventSource', events);

        };
        $.ajax(options);

    }

    function LimparAgenda() {

        $('#FiltrarSede').val("");
        $('#FiltrarProfissional').val("");

        FiltrarAgenda();
    }

</script>

