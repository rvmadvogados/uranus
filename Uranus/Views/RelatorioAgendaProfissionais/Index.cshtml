@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using ReportViewerForMvc;

<!-- page content -->
<div role="main">
    <div class="">

        <div class="row">

            <div class="col-md-12 col-sm-12 col-xs-12">
                <div>
                    @{ WebGrid grid = new WebGrid(Model); }

                    @using (Html.BeginForm("Index", "RelatorioAgendaProfissionais", FormMethod.Get, null))
                    {
                        <div class="row">
                            <div class="col-md-12 col-sm-12 col-xs-12">
                                <div class="x_panel">
                                    <div class="x_title">
                                        <h2>Filtrar Relatório Prazos Registrados </h2>
                                        <ul class="right panel_toolbox" style="list-style: none;">
                                            <li>
                                                <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                            </li>
                                        </ul>
                                        <div class="clearfix"></div>
                                    </div>
                                    <div class="x_content">

                                        <div class="row">
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label class="titlefield">Data Cadastro Inicio</label>
                                                    <div id="FiltrarDataInicio1" name="FiltrarDataInicio1" class="input-group date" style="margin: 0 !important;">
                                                        <input id="FiltrarDataInicio" name="FiltrarDataInicio" class="form-control placeholder" type="text" style="height: 40px !important;" value="@ViewBag.FiltrarDataInicio" readonly />
                                                        <span class="input-group-addon" style="border-radius: 0px !important; padding: 11px 12px !important;"><i class="glyphicon glyphicon-calendar"></i></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label class="titlefield">Data Cadastro Fim</label>
                                                    <div id="FiltrarDataFim1" name="FiltrarDataFim1" class="input-group date" style="margin: 0 !important;">
                                                        <input id="FiltrarDataFim" name="FiltrarDataFim" class="form-control placeholder" type="text" style="height: 40px !important;" value="@ViewBag.FiltrarDataFim" readonly />
                                                        <span class="input-group-addon" style="border-radius: 0px !important; padding: 11px 12px !important;"><i class="glyphicon glyphicon-calendar"></i></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label class="titlefield">Cumprimento Inicio</label>
                                                    <div id="FiltrarCumprimentoInicio1" name="FiltrarCumprimentoInicio1" class="input-group date" style="margin: 0 !important;">
                                                        <input id="FiltrarCumprimentoInicio" name="FiltrarCumprimentoInicio" class="form-control placeholder" type="text" style="height: 40px !important;" value="@ViewBag.FiltrarCumprimentoInicio" readonly />
                                                        <span class="input-group-addon" style="border-radius: 0px !important; padding: 11px 12px !important;"><i class="glyphicon glyphicon-calendar"></i></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label class="titlefield">Cumprimento Fim</label>
                                                    <div id="FiltrarCumprimentoFim1" name="FiltrarCumprimentoFim1" class="input-group date" style="margin: 0 !important;">
                                                        <input id="FiltrarCumprimentoFim" name="FiltrarCumprimentoFim" class="form-control placeholder" type="text" style="height: 40px !important;" value="@ViewBag.FiltrarCumprimentoFim" readonly />
                                                        <span class="input-group-addon" style="border-radius: 0px !important; padding: 11px 12px !important;"><i class="glyphicon glyphicon-calendar"></i></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group" style="vertical-align: bottom !important;">
                                                    <button type="submit" class="btn btn-primary" style="margin-top: 25px !important;">Filtrar</button>
                                                    &nbsp;
                                                    <button type="submit" class="btn btn-default" style="margin-top: 25px !important;" onclick="LimparFiltro();">Limpar</button>

                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="titlefield">Profissionais</label>
                                                    <select id="FiltrarProfissionais" name="FiltrarProfissionais" class="form-control" multiple="multiple"></select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="titlefield">Usuários</label>
                                                    <select id="FiltrarUsuarios" name="FiltrarUsuarios" class="form-control" multiple="multiple"></select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-9">
                                                <div class="form-group">
                                                    <label class="titlefield">Eventos</label>
                                                    <select id="FiltrarTiposEventos" name="FiltrarTiposEventos" class="form-control" multiple="multiple"></select>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label class="titlefield">Tipo de Relatórios</label>
                                                    <select id="FiltrarTipo" name="FiltrarTipo" class="form-control placeholder">
                                                        <option value="1">Sintético</option>
                                                        <option value="2">Analítico</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            @*@Html.ReportViewer(ViewBag.ReportViewer as Microsoft.Reporting.WebForms.ReportViewer, new { frameborder = "0", width = "500", height = "5000", style = "overflow:hidden;", scrolling = "no" })*@
                            @Html.ReportViewer(ViewBag.ReportViewer as Microsoft.Reporting.WebForms.ReportViewer)
                        </div>
                    }
                </div>
            </div>

        </div>
    </div>

</div>
<!-- /page content -->
<!-- datepicker -->
<script type="text/javascript" src="~/Scripts/datepicker/bootstrap-datepicker.min.js"></script>
<script type="text/javascript" src="~/Scripts/datepicker/locales/bootstrap-datepicker.pt-BR.min.js"></script>

<!-- select2 -->
<script src="~/Scripts/select/select2.full.js"></script>

<script>

    $(window).load(function () {

        $("#FiltrarProfissionais").select2({
            placeholder: "Selecione um ou mais Profissional",
            allowClear: true,
            tags: true,
            maximumSelectionLength: 100
        });

        $("#FiltrarUsuarios").select2({
            placeholder: "Selecione um ou mais Usuário",
            allowClear: true,
            tags: true,
            maximumSelectionLength: 100
        });

        $("#FiltrarTiposEventos").select2({
            placeholder: "Selecione um ou mais Evento",
            allowClear: true,
            tags: true,
            maximumSelectionLength: 100
        });

        $("#FiltrarDataInicio1").datepicker({
            format: 'dd/mm/yyyy',
            language: 'pt-BR',
            autoclose: true,
            todayHighlight: true,
            orientation: "bottom",
            //daysOfWeekDisabled: [0, 6],
            clearBtn: true,
            datesDisabled: [@Html.Raw(Uranus.Suite.Controllers.FeriadosController.Desabilitar())]
        });

        $("#FiltrarDataFim1").datepicker({
            format: 'dd/mm/yyyy',
            language: 'pt-BR',
            autoclose: true,
            todayHighlight: true,
            orientation: "bottom",
            //daysOfWeekDisabled: [0, 6],
            clearBtn: true,
            datesDisabled: [@Html.Raw(Uranus.Suite.Controllers.FeriadosController.Desabilitar())]
        });
        $("#FiltrarCumprimentoInicio1").datepicker({
            format: 'dd/mm/yyyy',
            language: 'pt-BR',
            autoclose: true,
            todayHighlight: true,
            orientation: "bottom",
            //daysOfWeekDisabled: [0, 6],
            clearBtn: true,
            datesDisabled: [@Html.Raw(Uranus.Suite.Controllers.FeriadosController.Desabilitar())]
        });

        $("#FiltrarCumprimentoFim1").datepicker({
            format: 'dd/mm/yyyy',
            language: 'pt-BR',
            autoclose: true,
            todayHighlight: true,
            orientation: "bottom",
            //daysOfWeekDisabled: [0, 6],
            clearBtn: true,
            datesDisabled: [@Html.Raw(Uranus.Suite.Controllers.FeriadosController.Desabilitar())]
        });
    });

        CarregarProfissionais();
        CarregarUsuarios();
        CarregarEventos();

        function CarregarProfissionais() {
            var options = {};
            options.url = "/Profissionais/Listar"
            options.type = "POST";
            options.asyn = true;
            options.contentType = false;
            options.processData = false;
            options.dataType = "application/json; charset=utf-8";
            options.complete = function (data) {

                var json = $.parseJSON(data.responseText);

                if (json.codigo == '00') {

                    var rows = json.profissionais;
                    $('#FiltrarProfissionais').html("");
                    var select = $('#FiltrarProfissionais');
                    for (index = 0; index < rows.length; index++) {
                        select.append(
                            $('<option></option>').val(rows[index].Id).html(rows[index].Nome)
                        );
                    }

                    $('#FiltrarProfissionais').val(@Html.Raw(Json.Encode(ViewBag.FiltrarProfissionais)));
                    $('#FiltrarProfissionais').trigger('change');

                }
            };
            $.ajax(options);
        }

        function CarregarUsuarios() {
            var options = {};
            options.url = "/Usuarios/Listar"
            options.type = "POST";
            options.asyn = true;
            options.contentType = false;
            options.processData = false;
            options.dataType = "application/json; charset=utf-8";
            options.complete = function (data) {

                var json = $.parseJSON(data.responseText);

                if (json.codigo == '00') {

                    var rows = json.usuarios;
                    $('#FiltrarUsuarios').html("");
                    var select = $('#FiltrarUsuarios');
                    for (index = 0; index < rows.length; index++) {
                        select.append(
                            $('<option></option>').val(rows[index].Id).html(rows[index].Nome)
                        );
                    }

                    $('#FiltrarUsuarios').val(@Html.Raw(Json.Encode(ViewBag.FiltrarUsuarios)));
                    $('#FiltrarUsuarios').trigger('change');

                }
            };
            $.ajax(options);
        }

        function CarregarEventos() {

            var options = {};
            options.url = "/Eventos/Listar"
            options.type = "POST";
            options.asyn = true;
            options.contentType = false;
            options.processData = false;
            options.dataType = "application/json; charset=utf-8";
            options.complete = function (data) {

                var json = $.parseJSON(data.responseText);

                if (json.codigo == '00') {

                    var rows = json.eventos;
                    $('#FiltrarTiposEventos').html("");
                    var select = $('#FiltrarTiposEventos');
                    for (index = 0; index < rows.length; index++) {
                        select.append(
                            $('<option></option>').val(rows[index].Id).html(rows[index].Nome)
                        );
                    }

                    $('#FiltrarTiposEventos').val(@Html.Raw(Json.Encode(ViewBag.FiltrarTiposEventos)));
                    $('#FiltrarTiposEventos').trigger('change');

                }
            };
            $.ajax(options);
        }

        function LimparFiltro() {

            $('#FiltrarDataInicio').val("");
            $('#FiltrarDataFim').val("");
            $('#FiltrarCumprimentoInicio').val("");
            $('#FiltrarCumprimentoFim').val("");

            $('#FiltrarProfissionais').val("");
            $('#FiltrarProfissionais').trigger('change');

            $('#FiltrarUsuarios').val("");
            $('#FiltrarUsuarios').trigger('change');

            $('#FiltrarTiposEventos').val("");
            $('#FiltrarTiposEventos').trigger('change');

            //$("#evento-filtro-form").submit();
        }


</script>